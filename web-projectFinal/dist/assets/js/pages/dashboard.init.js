var pollingData,fivethirtyeightData,prData,myInit={method:"GET",headers:{"Content-Type":"application/json"},mode:"cors",cache:"default"};function populateWordCloud(e,t){var r;for(d in document.getElementById("topic1").innerHTML="",document.getElementById("topic2").innerHTML="",document.getElementById("topic3").innerHTML="",document.getElementById("topic4").innerHTML="",document.getElementById("topic5").innerHTML="",e)e[d].date==t&&(r=e[d].topics);var a=[];for(cT in r){var n=r[cT];for(words in n)a.push({x:words,value:n[words],category:words});createWordCloud(a,parseInt(cT)+1)}}function CreateTableFromJSON(e,t){var r,a=[];for(d in e)e[d].date==t&&(r=e[d].tweets);for(f in r)dict={Tweet:r[f].text,"Processed Tweet":r[f].processed_text,"Compounded Sentiment":r[f].compounded,"Positive Sentiment":r[f].positive,"Neutral Sentiment":r[f].neutral,"Negative Sentiment":r[f].negative,"Sarcasm Value":r[f].sarcasm_value},a.push(dict);for(var n=[],o=0;o<a.length;o++)for(var i in a[o])-1===n.indexOf(i)&&n.push(i);var s=document.createElement("table");s.setAttribute("class","table table-centered datatable dt-responsive nowrap"),s.setAttribute("style","border-collapse: collapse; border-spacing: 0; width: 100%;");var l=s.insertRow(-1);l.setAttribute("class","thead-light");for(o=0;o<n.length;o++){var u=document.createElement("th");u.innerHTML=n[o],l.appendChild(u)}for(o=0;o<a.length;o++){l=s.insertRow(-1);for(var c=0;c<n.length;c++)l.insertCell(-1).innerHTML=a[o][n[c]]}dateArr=t.split("-"),day=dateArr[2],month={"01":"January","02":"February","03":"March","04":"April","05":"May","06":"June","07":"July","08":"August","09":"September",10:"October",11:"November",12:"December"}[dateArr[1]],year=dateArr[0],newForm=day+"-"+month+"-"+year;var p=document.getElementById("tweetsTableTitle");p.innerHTML="",p.innerHTML="Tweets Table "+newForm;p=document.getElementById("tweetTable");p.innerHTML="",p.appendChild(s)}function createWordCloud(e,t){e=anychart.tagCloud(e);e.title("Topic"+t),e.angles([0]),e.colorRange(!1),e.colorRange().length("80%"),e.container("topic"+t),e.draw()}function createChart(e,t,r,a){a={chart:{height:350,zoom:{enabled:!0},toolbar:{show:!0}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:3},series:[{name:"Tweet Sentiment",type:"line",data:t},{name:"Five Thirty Eight",type:"line",data:r}],colors:["#00E396","#FEB019"],xaxis:{type:"datetime",categories:a},yaxis:[{seriesName:"Tweet Sentiment",axisTicks:{show:!0},axisBorder:{show:!0,color:"#00E396"},labels:{style:{colors:"#00E396"}},title:{text:"Tweet sentiments",style:{color:"#00E396"}}},{seriesName:"Five Thirty Eight",opposite:!0,axisTicks:{show:!0},axisBorder:{show:!0,color:"#FEB019"},labels:{style:{colors:"#FEB019"}},title:{text:"Revenue (thousand crores)",style:{color:"#FEB019"}}}],grid:{borderColor:"#f1f1f1",padding:{bottom:15}},tooltip:{x:{format:"dd/MM/yy HH:mm"}},legend:{offsetY:7}};new ApexCharts(document.querySelector("#"+e),a).render()}a="",fetch("https://projects.fivethirtyeight.com/polls/president-general/national/polling-average.json").then(function(e){return e.ok?e.json():Promise.reject(e)}).then(function(e){return fivethirtyeightData=e,fetch("https://cors-anywhere.herokuapp.com/http://138.91.35.252/output/processed.json",{headers:{"x-requested-with":"xmlhttprequest"}})}).then(function(e){return e.ok?e.json():Promise.reject(e)}).then(function(e){for(pD in totalDateArr=[],fteBidenArr=[],fteTrumpArr=[],bidenCompoundArr=[],trumpCompoundArr=[],pollingData=e){for(item in curDate=pollingData[pD].date,fivethirtyeightData)if(fivethirtyeightData[item].date==curDate)if("Joseph R. Biden Jr."==fivethirtyeightData[item].candidate)for(i=0;i<24;i++)fteBidenArr.push(Math.trunc(fivethirtyeightData[item].pct_trend_adjusted.toFixed(2)));else for(i=0;i<24;i++)fteTrumpArr.push(Math.trunc(fivethirtyeightData[item].pct_trend_adjusted.toFixed(2)));for(s in sentiments=pollingData[pD].sentiments,sentiments)try{if(curS=sentiments[s],Array.isArray(curS.biden)&&curS.biden.length||Array.isArray(curS.trump)&&curS.trump.length)continue;curS.hour<=9?totalDateArr.push(curDate+"T0"+curS.hour+":00:00"):10<=curS.hour&&totalDateArr.push(curDate+"T"+curS.hour+":00:00"),bidenCompoundArr.push(Math.trunc(100*curS.biden.compounded.toFixed(2))),trumpCompoundArr.push(Math.trunc(100*curS.trump.compounded.toFixed(2)))}catch(e){bidenCompoundArr.push(0),trumpCompoundArr.push(0)}}firstDate=pollingData[0].date,lastDate=pollingData[pollingData.length-1].date,firstDateArr=firstDate.split("-"),lastDateArr=lastDate.split("-"),$("#dateRange").ionRangeSlider({skin:"big",type:"single",grid:!0,min:dateToTS(new Date(firstDateArr[0],firstDateArr[1]-1,firstDateArr[2])),max:dateToTS(new Date(lastDateArr[0],lastDateArr[1]-1,lastDateArr[2])),from:dateToTS(new Date(firstDateArr[0],firstDateArr[1]-1,firstDateArr[2])),prettify:tsToDate,onFinish:function(e){dateArr=e.from_pretty.split(" "),day=dateArr[1].substring(0,2),","==day.substr(-1)&&(day="0"+day.substr(0,1)),console.log(day),month={January:"01",February:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12"}[dateArr[0]],year=dateArr[2],newForm=year+"-"+month+"-"+day;e=JSON.parse(sessionStorage.getItem("pollingData"));populateWordCloud(e,newForm),CreateTableFromJSON(e,newForm)}}),sessionStorage.setItem("pollingData",JSON.stringify(pollingData)),populateWordCloud(pollingData,pollingData[0].date),createChart("trumpSentimentChart",trumpCompoundArr,fteTrumpArr,totalDateArr),createChart("bidenSentimentChart",bidenCompoundArr,fteBidenArr,totalDateArr),CreateTableFromJSON(pollingData,firstDate)}).catch(function(e){console.warn(e)}),fetch("https://cors-anywhere.herokuapp.com/http://138.91.35.252/output/correlation.json",{headers:{"x-requested-with":"xmlhttprequest"}}).then(function(e){return e.ok?e.json():Promise.reject(e)}).then(function(e){prData=e;var t=document.getElementById("trumpPValue"),r=document.getElementById("trumpRValue"),a=document.getElementById("bidenPValue"),e=document.getElementById("bidenRValue");t.innerHTML="Trump P Value: "+prData.trump_p,r.innerHTML="Trump R Value: "+prData.trump_r,a.innerHTML="Biden P Value: "+prData.biden_p,e.innerHTML="Biden R Value: "+prData.biden_r});var lang="en-US";function dateToTS(e){return e.valueOf()}function tsToDate(e){return new Date(e).toLocaleDateString(lang,{year:"numeric",month:"long",day:"numeric"})}