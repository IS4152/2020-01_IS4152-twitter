var pollingData,fivethirtyeightData,myInit={method:"GET",headers:{"Content-Type":"application/json"},mode:"cors",cache:"default"};function populateWordCloud(t,e){var r;for(d in document.getElementById("topic1").innerHTML="",document.getElementById("topic2").innerHTML="",document.getElementById("topic3").innerHTML="",document.getElementById("topic4").innerHTML="",document.getElementById("topic5").innerHTML="",t)t[d].date==e&&(r=t[d].topics);var a=[];for(cT in r){var n=r[cT];for(words in n)a.push({x:words,value:n[words],category:words});createWordCloud(a,parseInt(cT)+1)}}function CreateTableFromJSON(){for(var t=[{"Book ID":"1","Book Name":"Computer Architecture",Category:"Computers",Price:"125.60"},{"Book ID":"2","Book Name":"Asp.Net 4 Blue Book",Category:"Programming",Price:"56.00"},{"Book ID":"3","Book Name":"Popular Science",Category:"Science",Price:"210.40"}],e=[],r=0;r<t.length;r++)for(var a in t[r])-1===e.indexOf(a)&&e.push(a);for(var n=document.createElement("table"),o=n.insertRow(-1),r=0;r<e.length;r++){var i=document.createElement("th");i.innerHTML=e[r],o.appendChild(i)}for(r=0;r<t.length;r++){o=n.insertRow(-1);for(var d=0;d<e.length;d++)o.insertCell(-1).innerHTML=t[r][e[d]]}var u=document.getElementById("showData");u.innerHTML="",u.appendChild(n)}function createWordCloud(t,e){t=anychart.tagCloud(t);t.title("Topic"+e),t.angles([0]),t.colorRange(!1),t.colorRange().length("80%"),t.container("topic"+e),t.draw()}function createChart(t,e,r,a){a={chart:{height:350,type:"line",zoom:{enabled:!0},toolbar:{show:!0}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:3},series:[{name:"Tweet Sentiment",data:e},{name:"Five Thirty Eight",data:r}],colors:["#5664d2","#1cbb8c"],xaxis:{type:"datetime",categories:a},yaxis:{title:{text:"sentiment"},min:0,max:100},grid:{borderColor:"#f1f1f1",padding:{bottom:15}},tooltip:{x:{format:"dd/MM/yy HH:mm"}},legend:{offsetY:7}};new ApexCharts(document.querySelector("#"+t),a).render()}a="",fetch("https://projects.fivethirtyeight.com/polls/president-general/national/polling-average.json").then(function(t){return t.ok?t.json():Promise.reject(t)}).then(function(t){return fivethirtyeightData=t,fetch("http://138.91.35.252/output/processed.json")}).then(function(t){return t.ok?t.json():Promise.reject(t)}).then(function(t){for(pD in totalDateArr=[],fteBidenArr=[],fteTrumpArr=[],bidenCompoundArr=[],trumpCompoundArr=[],pollingData=t){for(item in curDate=pollingData[pD].date,fivethirtyeightData)if(fivethirtyeightData[item].date==curDate)if("Joseph R. Biden Jr."==fivethirtyeightData[item].candidate)for(i=0;i<24;i++)fteBidenArr.push(Math.trunc(fivethirtyeightData[item].pct_trend_adjusted.toFixed(2)));else for(i=0;i<24;i++)fteTrumpArr.push(Math.trunc(fivethirtyeightData[item].pct_trend_adjusted.toFixed(2)));for(s in sentiments=pollingData[pD].sentiments,sentiments)try{if(curS=sentiments[s],Array.isArray(curS.biden)&&curS.biden.length||Array.isArray(curS.trump)&&curS.trump.length)continue;curS.hour<=9?totalDateArr.push(curDate+"T0"+curS.hour+":00:00"):10<=curS.hour&&totalDateArr.push(curDate+"T"+curS.hour+":00:00"),bidenCompoundArr.push(50+Math.trunc(100*curS.biden.compounded.toFixed(2))),trumpCompoundArr.push(50+Math.trunc(100*curS.trump.compounded.toFixed(2)))}catch(t){bidenCompoundArr.push(50),trumpCompoundArr.push(50)}}firstDate=pollingData[0].date,lastDate=pollingData[pollingData.length-1].date,firstDateArr=firstDate.split("-"),lastDateArr=lastDate.split("-"),$("#dateRange").ionRangeSlider({skin:"big",type:"single",grid:!0,min:dateToTS(new Date(firstDateArr[0],firstDateArr[1]-1,firstDateArr[2])),max:dateToTS(new Date(lastDateArr[0],lastDateArr[1]-1,lastDateArr[2])),from:dateToTS(new Date(firstDateArr[0],firstDateArr[1]-1,firstDateArr[2])),prettify:tsToDate,onFinish:function(t){dateArr=t.from_pretty.split(" "),day=dateArr[1].substring(0,2),month={January:"01",February:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12"}[dateArr[0]],year=dateArr[2],newForm=year+"-"+month+"-"+day,populateWordCloud(JSON.parse(sessionStorage.getItem("pollingData")),newForm)}}),sessionStorage.setItem("pollingData",JSON.stringify(pollingData)),populateWordCloud(pollingData,pollingData[0].date),createChart("trumpSentimentChart",trumpCompoundArr,fteTrumpArr,totalDateArr),createChart("bidenSentimentChart",bidenCompoundArr,fteBidenArr,totalDateArr)}).catch(function(t){console.warn(t)});var lang="en-US";function dateToTS(t){return t.valueOf()}function tsToDate(t){return new Date(t).toLocaleDateString(lang,{year:"numeric",month:"long",day:"numeric"})}